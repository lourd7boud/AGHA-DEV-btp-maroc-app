# ูุธุงู Super Admin

## ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุธุงู ูููุฑ ุฅุฏุงุฑุฉ ูุงููุฉ ูููุณุชุฎุฏููู ูู ุฎูุงู ุญุณุงุจ **Super Admin** ุงูุฐู ููุชูู ุฌููุน ุงูุตูุงุญูุงุช.

## ุงููุฒุงูุง

### 1. ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- ุฅูุดุงุก ุญุณุงุจุงุช ูุณุชุฎุฏููู ุฌุฏูุฏุฉ
- ุชูุนูู/ุชุนุทูู ุงูุญุณุงุจุงุช
- ุญุฐู ุงููุณุชุฎุฏููู
- ุชุนููู ุงูุฃุฏูุงุฑ (Super Admin, Admin, User)

### 2. ูุชุฑุงุช ุงูุชุฌุฑุจุฉ
- ุฅุถุงูุฉ ูุชุฑุฉ ุชุฌุฑุจุฉ ูุญุฏูุฏุฉ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
- ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุชูุงุก ุงููุชุฑุฉ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุชุนุทูู ุงูุญุณุงุจุงุช ุชููุงุฆูุงู ุนูุฏ ุงูุชูุงุก ุงููุชุฑุฉ
- ุฅููุงููุฉ ุชูุฏูุฏ ุฃู ุฅูุบุงุก ูุชุฑุฉ ุงูุชุฌุฑุจุฉ

### 3. ุณุฌู ุงูุฃูุดุทุฉ (Audit Log)
- ุชุณุฌูู ุฌููุน ุงูุฅุฌุฑุงุกุงุช ุงูุฅุฏุงุฑูุฉ
- ุนุฑุถ ุงููุดุงุท ุงูุฃุฎูุฑ ูู ููุญุฉ ุงูุชุญูู
- ุชุชุจุน ูู ูุงู ุจุฅูุดุงุก/ุชุนุฏูู/ุญุฐู ุงููุณุชุฎุฏููู

## ุงูุฃุฏูุงุฑ

### Super Admin
- **ุงูุตูุงุญูุงุช**: ูุงููุฉ
- **ุงููุฏุฑุงุช**:
  - ุฅูุดุงุก/ุชุนุฏูู/ุญุฐู ุฌููุน ุงููุณุชุฎุฏููู
  - ุงููุตูู ูุฌููุน ุงููุดุงุฑูุน
  - ุฅุฏุงุฑุฉ ุงููุธุงู ุจุงููุงูู
  - ุนุฑุถ ุณุฌู ุงูุฃูุดุทุฉ

### Admin
- **ุงูุตูุงุญูุงุช**: ูุญุฏูุฏุฉ
- **ุงููุฏุฑุงุช**:
  - ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน
  - ุนุฑุถ ุงูุชูุงุฑูุฑ
  - ูุง ูููู ุฅูุดุงุก ูุณุชุฎุฏููู

### User
- **ุงูุตูุงุญูุงุช**: ุฃุณุงุณูุฉ
- **ุงููุฏุฑุงุช**:
  - ุงููุตูู ูููุดุงุฑูุน ุงููุฎุตุตุฉ
  - ุฅูุดุงุก ูุชุนุฏูู ุงูุจูุงูุงุช
  - ูุง ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ

## ุฅูุดุงุก ุฃูู Super Admin

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงูุณูุฑูุจุช

```bash
cd backend
npm run create-super-admin
```

### ุงูุฎุทูุฉ 2: ุจูุงูุงุช ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ

```
Email: admin@agriculture.gov.ma
Password: Admin@2024
```

โ๏ธ **ููู ุฌุฏุงู**: ูู ุจุชุบููุฑ ูููุฉ ุงููุฑูุฑ ูุจุงุดุฑุฉ ุจุนุฏ ุฃูู ุชุณุฌูู ุฏุฎูู!

## ุงููุตูู ูุตูุญุฉ ุงูุฅุฏุงุฑุฉ

1. ุณุฌู ุงูุฏุฎูู ูู Super Admin
2. ุณุชุธูุฑ ุฃููููุฉ "Administration" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
3. ุงุถุบุท ุนูููุง ูููุตูู ูููุญุฉ ุงูุชุญูู

## ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ

### ูู ูุงุฌูุฉ ุงูููุจ

1. ุงุฐูุจ ุฅูู: **Administration โ Gรฉrer les utilisateurs**
2. ุงุถุบุท ุนูู **Nouvel Utilisateur**
3. ุงููุฃ ุงูุจูุงูุงุช:
   - ุงูุงุณู ุงูุฃูู ูุงูุฃุฎูุฑ
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ูููุฉ ุงููุฑูุฑ
   - ุงูุฏูุฑ (User ุฃู Admin)
   - ูุชุฑุฉ ุชุฌุฑุจุฉ (ุงุฎุชูุงุฑู)
4. ุงุถุบุท **Crรฉer**

### ููุงุญุธุงุช ูููุฉ

- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ูุฌุจ ุฃู ูููู ูุฑูุฏุงู
- **ูููุฉ ุงููุฑูุฑ** ุณูุชู ุนุฑุถูุง ูุฑุฉ ูุงุญุฏุฉ ููุท
- ูู ุจูุณุฎ ูููุฉ ุงููุฑูุฑ ูุฅุฑุณุงููุง ูููุณุชุฎุฏู ุจุดูู ุขูู
- **ูุชุฑุฉ ุงูุชุฌุฑุจุฉ** (ุงุฎุชูุงุฑู):
  - ุฅุฐุง ูุนูุชุ ุญุฏุฏ ุนุฏุฏ ุงูุฃูุงู (ุงูุชุฑุงุถู: 30 ููู)
  - ุณูุชู ุชุนุทูู ุงูุญุณุงุจ ุชููุงุฆูุงู ุจุนุฏ ุงูุชูุงุก ุงููุชุฑุฉ

## ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

### ุชูุนูู/ุชุนุทูู ุญุณุงุจ

- ุงุถุบุท ุนูู ุฃููููุฉ ๐ ูุชุนุทูู ุญุณุงุจ ูุดุท
- ุงุถุบุท ุนูู ุฃููููุฉ ๐ ูุชูุนูู ุญุณุงุจ ูุนุทู

### ุญุฐู ูุณุชุฎุฏู

- ุงุถุบุท ุนูู ุฃููููุฉ ๐๏ธ
- ุณูุทูุจ ููู ุชุฃููุฏ ุงูุญุฐู
- **ุชุญุฐูุฑ**: ูุง ูููู ุงูุชุฑุงุฌุน ุนู ุงูุญุฐู

### ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู

ูู ููุญุฉ ุงูุชุญููุ ููููู ุฑุคูุฉ:
- **Total Utilisateurs**: ุฅุฌูุงูู ุนุฏุฏ ุงููุณุชุฎุฏููู
- **Utilisateurs Actifs**: ุงููุณุชุฎุฏููู ุงููุดุทูู ุญุงููุงู
- **Pรฉriodes d'essai**: ุงููุณุชุฎุฏููู ูู ูุชุฑุฉ ุชุฌุฑุจุฉ ูุดุทุฉ
- **Essais Expirรฉs**: ูุชุฑุงุช ุงูุชุฌุฑุจุฉ ุงูููุชููุฉ

## ุณุฌู ุงูุฃูุดุทุฉ

ูุชู ุชุณุฌูู ุฌููุน ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ:
- `create_user`: ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ
- `disable_user`: ุชุนุทูู ูุณุชุฎุฏู
- `enable_user`: ุชูุนูู ูุณุชุฎุฏู
- `delete_user`: ุญุฐู ูุณุชุฎุฏู
- `extend_trial`: ุชูุฏูุฏ ูุชุฑุฉ ุงูุชุฌุฑุจุฉ
- `update_role`: ุชุบููุฑ ุฏูุฑ ุงููุณุชุฎุฏู

ูู ุณุฌู ูุญุชูู ุนูู:
- ูู ูุงู ุจุงูุฅุฌุฑุงุก (userEmail)
- ููุน ุงูุฅุฌุฑุงุก (action)
- ุนูู ูู ุชู ุงูุฅุฌุฑุงุก (entityId)
- ุชูุงุตูู ุฅุถุงููุฉ (details)
- ุงูุชุงุฑูุฎ ูุงูููุช (timestamp)

## ุงูุฃูุงู

### ุญูุงูุฉ ุงูุตูุญุงุช

- `/admin` ู `/admin/users` ูุญููุฉ ุจุงููุงูู
- ููุท Super Admin ููููู ุงููุตูู
- ุฃู ูุญุงููุฉ ูุตูู ุบูุฑ ูุตุฑุญ ุจูุง ุณูุชู ุฑูุถูุง

### ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุญุณุงุจุงุช

ุนูุฏ ูู ุชุณุฌูู ุฏุฎูู:
1. ุงูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ
2. ุงูุชุญูู ูู ุฃู ุงูุญุณุงุจ ูุดุท (`isActive === true`)
3. ุงูุชุญูู ูู ูุชุฑุฉ ุงูุชุฌุฑุจุฉ (ุฅู ูุฌุฏุช)
4. ุชุญุฏูุซ ุชุงุฑูุฎ ุขุฎุฑ ุชุณุฌูู ุฏุฎูู

### ูููุงุช ุงููุฑูุฑ

- ูุชู ุชุดููุฑูุง ุจุงุณุชุฎุฏุงู bcrypt
- ูุง ูููู ูุฃุญุฏ (ุญุชู Super Admin) ุฑุคูุฉ ูููุงุช ุงููุฑูุฑ
- ูุฌุจ ุนูู ูู ูุณุชุฎุฏู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุงูุฃูููุฉ

## ุงูุชูุงูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช

### Schema v6

ุชู ุชุญุฏูุซ `database.ts` ุฅูู ุงูุฅุตุฏุงุฑ 6:

```typescript
interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  role: 'super_admin' | 'admin' | 'user';
  isActive: boolean;
  trialEndDate?: string;  // ISO date string
  createdBy?: string;     // User ID who created this account
  createdAt: string;      // ISO date string
  lastLogin?: string;     // ISO date string
}

interface AuditLog {
  id: string;
  userId: string;
  userEmail: string;
  action: string;
  entityType: string;
  entityId: string;
  details: any;
  ipAddress?: string;
  timestamp: string;      // ISO date string
}
```

### Migration

ุนูุฏ ูุชุญ ุงูุชุทุจููุ ุณูุชู:
1. ุชุฑููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุงุฆูุงู ููุฅุตุฏุงุฑ 6
2. ุฅุถุงูุฉ ุฌุฏูู `auditLogs`
3. ุชุญุฏูุซ indexes ูุฌุฏูู `users`

## Best Practices

### ููู Super Admin

1. โ **ูู ุจุชุบููุฑ ูููุฉ ุงููุฑูุฑ ููุฑุงู** ุจุนุฏ ุฃูู ุชุณุฌูู ุฏุฎูู
2. โ **ูุง ุชุดุงุฑู ุจูุงูุงุช ุงูุฏุฎูู** ูุน ุฃู ุดุฎุต
3. โ **ุฃูุดุฆ ุญุณุงุจุงุช ูุฑุฏูุฉ** ููู ูุณุชุฎุฏู
4. โ **ุงุณุชุฎุฏู ูุชุฑุงุช ุชุฌุฑุจุฉ** ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
5. โ **ุฑุงุฌุน ุณุฌู ุงูุฃูุดุทุฉ** ุจุงูุชุธุงู

### ูููุณุชุฎุฏููู ุงูุฌุฏุฏ

1. โ **ุบููุฑ ูููุฉ ุงููุฑูุฑ** ูุจุงุดุฑุฉ ุจุนุฏ ุฃูู ุฏุฎูู
2. โ **ูุง ุชุดุงุฑู ุญุณุงุจู** ูุน ุงูุขุฎุฑูู
3. โ **ุฅุฐุง ูุณูุช ูููุฉ ุงููุฑูุฑ** ุงุชุตู ุจุงูู Super Admin

## ุงูุฅุฒุงูุฉ ุงููุณุชูุจููุฉ

ุชู ุฅุฎูุงุก ุตูุญุฉ ุงูุชุณุฌูู ุงูุนุงูุฉ (`/register`) ุญูุซ:
- ููุท Super Admin ููููู ุฅูุดุงุก ุญุณุงุจุงุช
- ุธูุฑุช ุฑุณุงูุฉ ูู ุตูุญุฉ Login ุชูุถุญ ุฃู ุงูุญุณุงุจุงุช ุชููุดุฃ ูู ูุจู ุงูุฅุฏุงุฑุฉ

ุฅุฐุง ุฃุฑุฏุช ุฅุฒุงูุฉ `/register` ุจุงููุงูู:
```typescript
// ูู App.tsx ุงุญุฐู ูุฐุง ุงูุณุทุฑ:
<Route path="/register" element={<RegisterPage />} />
```

## ุงูุฏุนู

ูู ุญุงู ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ุณุฌู ุงูุฃูุดุทุฉ (Audit Log)
2. ุฑุงุฌุน console.log ููุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุชุดุบูู CouchDB
4. ุชุฃูุฏ ูู Database version 6
